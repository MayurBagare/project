@model IEnumerable<mytecsys.Models.UserInfo>
<!-- User Form -->
<form id="userForm">
    <h2>User Register</h2>
    <input type="hidden" id="Id" value="0" /> <!-- Hidden field to store user ID -->
    <!-- First Row: Name and Mobile No -->
    <div>
        <input type="text" id="Name" required placeholder="Name" />
    </div>
    <div>
        <input type="text" id="MobileNo" required maxlength="10" pattern="\d{10}" placeholder="Mobile No" />
    </div>

    <!-- Second Row: State and City -->
    <div>
        <select id="State" required>
            <option value="">Select State</option>
            <option value="Maharashtra">Maharashtra</option>
        </select>
    </div>
    <div>
        <select id="City" required>
            <option value="">Select City</option>
        </select>
    </div>

    <!-- Third Row: Address -->
    <div class="full-width">
        <input type="text" id="Address" required placeholder="Address.." />
    </div>

    <!-- Save Button -->
    <button type="submit" id="saveBtn">Save</button>
</form>

<!-- User List -->
<h2>Users</h2>
<table border="1">
    <thead>
        <tr>
            <th>Name</th>
            <th>Mobile No</th>
            <th>State</th>
            <th>City</th>
            <th>Address</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var user in Model)
        {
            <tr>
                <td>@user.Name</td>
                <td>@user.MobileNo</td>
                <td>@user.State</td>
                <td>@user.City</td>
                <td>@user.Address</td>
                <td>
                    <button onclick="editUser(@user.Id)">Edit</button>
                    <button onclick="deleteUser(@user.Id)">Delete</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- jQuery and AJAX Scripts -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        // Populate city dropdown based on selected state
        $('#State').change(function () {
            var state = $(this).val();
            $.get('/UserInfo/GetCities', { state: state }, function (data) {
                $('#City').empty();
                $.each(data, function (i, city) {
                    $('#City').append($('<option>').val(city).text(city));
                });
            });
        });

        // Save user data using AJAX
        $('#saveBtn').click(function (e) {
            e.preventDefault();
            var userData = {
                Id: $('#Id').val(),
                Name: $('#Name').val(),
                MobileNo: $('#MobileNo').val(),
                State: $('#State').val(),
                City: $('#City').val(),
                Address: $('#Address').val()
            };

            $.ajax({
                url: '/UserInfo/SaveUserInfo',
                type: 'POST',
                data: userData,
                success: function (response) {
                    if (response.success) {
                        alert("Data saved successfully.");
                        location.reload(); // Refresh the page
                    } else {
                        alert("Error saving data.");
                    }
                }
            });
        });

        // Load user data for editing
        window.editUser = function (id) {
            $.get('/UserInfo/GetUserById', { id: id }, function (data) {
                $('#Id').val(data.Id); // Set the hidden field with the user Id
                $('#Name').val(data.Name); // Set the name
                $('#MobileNo').val(data.MobileNo); // Set the mobile number
                $('#State').val(data.State).trigger('change'); // Set the state and trigger city dropdown
                $('#City').val(data.City); // Set the city
                $('#Address').val(data.Address); // Set the address
            });
        };

        // Delete user
        window.deleteUser = function (id) {
            if (confirm("Are you sure you want to delete this user?")) {
                $.post('/UserInfo/DeleteUser', { id: id }, function (response) {
                    if (response.success) {
                        alert("User deleted successfully.");
                        location.reload(); // Refresh the page
                    } else {
                        alert("Error deleting user.");
                    }
                });
            }
        };
    });
</script>

<style>
    form {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* 2 columns */
        gap: 20px; /* Spacing between rows and columns */
        max-width: 600px;
        margin: 0 auto;
        border: 3px solid black;
        padding: 50px;
        padding-top: 25px;
    }

    h2 {
        grid-column: span 2; /* Title spans both columns */
        text-align: center;
    }

    .full-width {
        grid-column: span 2;
    }

    input, select {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
    }

    button {
        grid-column: span 2;
        padding: 10px;
        cursor: pointer;
        background-color: #4CAF50;
        color: black;
    }

    table {
        width: 100%;
        border-collapse: collapse; /* Ensure borders are collapsed together */
        margin-top: 20px;
        border: 3px solid black;
    }

    th, td {
        border: 1px solid black; /* Add border around each cell */
        padding: 10px;
        text-align: center;
    }

    th {
        background-color: #f2f2f2; /* Light grey background for table headers */
    }
</style>
